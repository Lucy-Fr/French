<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dialogue : Au supermarch√© ‚Äî exercice √† trous et grammaire</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .question { margin-bottom: 20px; }
    .correct { background-color: #c8f7c5; }
    .missed { background-color: #fce3e3; }
    .explanation { color: green; display: none; margin-top: 5px; }
    button { margin: 5px; }
  </style>
</head>
<body>
<h2>Dialogue : Au supermarch√© ‚Äî exercice √† trous avec audio</h2>
<p>Compl√©tez les mots manquants dans ce dialogue. Cliquez sur üîä pour √©couter chaque ligne.</p>

<div id="dialogue-container"></div>

<h3>Exercice de grammaire</h3>
<p>Compl√©tez avec la bonne forme du verbe <em>vouloir</em> (pr√©sent) :</p>
<ul>
  <li>Je <input type="text" id="g1" placeholder="..."> acheter une bouteille d‚Äôeau.</li>
  <li>Ils <input type="text" id="g2" placeholder="..."> du fromage.</li>
  <li>Tu <input type="text" id="g3" placeholder="..."> autre chose ?</li>
</ul>
<button onclick="checkGrammar()">V√©rifier la grammaire</button>
<p id="grammar-score" class="result" style="display: none;"></p>

<button onclick="checkAnswers()">V√©rifier le dialogue</button>
<button onclick="resetDialogue()">R√©initialiser</button>
<p id="score" class="result" style="display: none;"></p>

<script>
const dialogue = [
  ["Client", "Bonjour, o√π sont les ___, s‚Äôil vous pla√Æt ?", "tomates"],
  ["Employ√©", "Elles sont dans le rayon fruits et l√©gumes, juste √† c√¥t√© des pommes de ___.", "terre"],
  ["Client", "Merci. Je vais en prendre un ___.", "kilo"],
  ["Employ√©", "Vous voulez autre chose ?", ""],
  ["Client", "Oui, avez-vous du ___ ?", "lait"],
  ["Employ√©", "Oui, il est dans le rayon des produits frais, pr√®s du ___.", "fromage"],
  ["Client", "Parfait, je vais aussi prendre un ___ de beurre.", "morceau"],
  ["Employ√©", "Bonne journ√©e √† vous !", ""],
  ["Client", "Merci, √† vous aussi !", ""]
];

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'fr-FR';
  speechSynthesis.speak(utterance);
}

function createDialogue() {
  const container = document.getElementById("dialogue-container");
  container.innerHTML = "";
  for (let i = 0; i < dialogue.length; i++) {
    const [speaker, line, answer] = dialogue[i];
    const qId = `q${i + 1}`;
    const hasBlank = line.includes("___");
    let inputField = "";
    if (hasBlank) {
      inputField = `<input type='text' id='${qId}' placeholder='...'>`;
    }
    const displayLine = line.replace("___", inputField);
    const html = `<div class='question'><strong>${speaker}:</strong> ${displayLine} <button onclick="speak(\"${line.replace('___', answer)}\")">üîä</button>
    <div id='exp${i + 1}' class='explanation'>‚úÖ ${line.replace('___', answer)}</div></div>`;
    container.innerHTML += html;
  }
}

function checkAnswers() {
  let score = 0;
  let total = 0;
  for (let i = 0; i < dialogue.length; i++) {
    const [_, line, answer] = dialogue[i];
    const qId = `q${i + 1}`;
    const exp = document.getElementById("exp" + (i + 1));
    const input = document.getElementById(qId);
    if (input) {
      total++;
      const val = input.value.trim().toLowerCase();
      input.classList.remove("correct", "missed");
      if (val === answer.toLowerCase()) {
        input.classList.add("correct");
        score++;
      } else {
        input.classList.add("missed");
      }
      exp.style.display = "block";
    }
  }
  const scoreText = document.getElementById("score");
  scoreText.innerText = `Vous avez ${score} bonne(s) r√©ponse(s) sur ${total}.`;
  scoreText.style.display = "block";
}

function resetDialogue() {
  for (let i = 0; i < dialogue.length; i++) {
    const qId = `q${i + 1}`;
    const exp = document.getElementById("exp" + (i + 1));
    const input = document.getElementById(qId);
    if (input) {
      input.value = "";
      input.classList.remove("correct", "missed");
    }
    if (exp) exp.style.display = "none";
  }
  document.getElementById("score").style.display = "none";
  document.getElementById("grammar-score").style.display = "none";
  document.getElementById("g1").value = "";
  document.getElementById("g2").value = "";
  document.getElementById("g3").value = "";
}

function checkGrammar() {
  const g1 = document.getElementById("g1").value.trim().toLowerCase();
  const g2 = document.getElementById("g2").value.trim().toLowerCase();
  const g3 = document.getElementById("g3").value.trim().toLowerCase();
  let score = 0;
  if (g1 === "veux") score++;
  if (g2 === "veulent") score++;
  if (g3 === "veux") score++;
  document.getElementById("grammar-score").innerText = `Grammaire : ${score}/3 bonne(s) r√©ponse(s).`;
  document.getElementById("grammar-score").style.display = "block";
}

window.onload = createDialogue;
</script>

<p>
  <a href="../a1_dialogues.html">‚Üê Retour aux dialogues</a> |
  <a href="../../index.html">üè† Accueil</a>
</p>
</body>
</html>
