<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dialogue : √Ä la boulangerie ‚Äî exercice √† trous</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .question { margin-bottom: 20px; }
    .correct { background-color: #c8f7c5; }
    .missed { background-color: #fce3e3; }
    .explanation { color: green; display: none; margin-top: 5px; }
    button { margin: 5px; }
  </style>
</head>
<body>
<h2>Dialogue : √Ä la boulangerie ‚Äî exercice √† trous avec audio</h2>
<p>Compl√©tez les mots manquants dans ce dialogue. Cliquez sur üîä pour √©couter chaque ligne.</p>

<div id="dialogue-container"></div>

<button onclick="checkAnswers()">V√©rifier</button>
<button onclick="resetDialogue()">R√©initialiser</button>
<p id="score" class="result" style="display: none;"></p>

<script>
const dialogue = [
  ["Client", "Bonjour, je voudrais une ___, s'il vous pla√Æt.", "baguette"],
  ["Boulang√®re", "Bien s√ªr ! Et avec ceci ?", ""],
  ["Client", "Je vais prendre aussi deux ___ au chocolat.", "pains"],
  ["Boulang√®re", "Tr√®s bien. Ce sera tout ?", ""],
  ["Client", "Oui, merci. Combien je vous ___ ?", "dois"],
  ["Boulang√®re", "√áa fait trois euros cinquante, s‚Äôil vous pla√Æt.", ""],
  ["Client", "Voil√†. Merci beaucoup.", ""],
  ["Boulang√®re", "Merci √† vous. Bonne ___ !", "journ√©e"]
];

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'fr-FR';
  speechSynthesis.speak(utterance);
}

function createDialogue() {
  const container = document.getElementById("dialogue-container");
  container.innerHTML = "";
  for (let i = 0; i < dialogue.length; i++) {
    const [speaker, line, answer] = dialogue[i];
    const qId = `q${i + 1}`;
    const hasBlank = line.includes("___");
    let inputField = "";
    if (hasBlank) {
      inputField = `<input type='text' id='${qId}' placeholder='...'>`;
    }
    const displayLine = line.replace("___", inputField);
    const html = `<div class='question'><strong>${speaker}:</strong> ${displayLine} <button onclick="speak(\"${line.replace('___', answer)}\")">üîä</button>
    <div id='exp${i + 1}' class='explanation'>‚úÖ ${line.replace('___', answer)}</div></div>`;
    container.innerHTML += html;
  }
}

function checkAnswers() {
  let score = 0;
  let total = 0;
  for (let i = 0; i < dialogue.length; i++) {
    const [_, line, answer] = dialogue[i];
    const qId = `q${i + 1}`;
    const exp = document.getElementById("exp" + (i + 1));
    const input = document.getElementById(qId);
    if (input) {
      total++;
      const val = input.value.trim().toLowerCase();
      input.classList.remove("correct", "missed");
      if (val === answer.toLowerCase()) {
        input.classList.add("correct");
        score++;
      } else {
        input.classList.add("missed");
      }
      exp.style.display = "block";
    }
  }
  const scoreText = document.getElementById("score");
  scoreText.innerText = `Vous avez ${score} bonne(s) r√©ponse(s) sur ${total}.`;
  scoreText.style.display = "block";
}

function resetDialogue() {
  for (let i = 0; i < dialogue.length; i++) {
    const qId = `q${i + 1}`;
    const exp = document.getElementById("exp" + (i + 1));
    const input = document.getElementById(qId);
    if (input) {
      input.value = "";
      input.classList.remove("correct", "missed");
    }
    if (exp) exp.style.display = "none";
  }
  document.getElementById("score").style.display = "none";
}

window.onload = createDialogue;
</script>

<p>
  <a href="../a1_dialogues.html">‚Üê Retour aux dialogues</a> |
  <a href="../../index.html">üè† Accueil</a>
</p>
</body>
</html>
